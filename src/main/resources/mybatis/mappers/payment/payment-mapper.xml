<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.petmate.repository.mybatis.payment.PaymentMapper">

    <resultMap id="PaymentMap" type="com.petmate.payment.entity.PaymentEntity">
        <id property="id" column="id"/>
        <result property="reservationId" column="reservation_id"/>
        <result property="provider" column="provider"/>
        <result property="providerTxId" column="provider_tx_id"/>
        <result property="amount" column="amount"/>
        <result property="currency" column="currency"/>
        <result property="status" column="status"/>
        <result property="paidAt" column="paid_at"/>
        <result property="cancelledAt" column="cancelled_at"/>
        <result property="rawJson" column="raw_json"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>

    <select id="findById" parameterType="int" resultMap="PaymentMap">
        SELECT * FROM payments WHERE id = #{id}
    </select>

    <select id="findByReservationId" parameterType="int" resultMap="PaymentMap">
        SELECT * FROM payments WHERE reservation_id = #{reservationId}
    </select>

    <update id="updateStatus">
        UPDATE payments
        SET status = #{status}, updated_at = CURRENT_TIMESTAMP
        WHERE id = #{id}
    </update>
</mapper>
